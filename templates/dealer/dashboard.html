{% extends '../_base.html' %}
{% block content %}
{% include './navbar.html' %}
{% include './sidebar.html' %}
{% include './cart.html' %}
  
  <div class="p-4 sm:ml-64 mt-14">
        <div class="grid grid-cols-3 gap-4">
           <div class="col-span-2">
              
            {% comment %}  {% endcomment %}
               <div class="w-full h-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">
                  <div class="flex justify-between pb-4 mb-4 border-b border-gray-200 dark:border-gray-700">
                  <div class="flex items-center">
                     <div class="w-12 h-12 rounded-lg dark:bg-gray-700 flex items-center justify-center me-3">
                        <svg class="w-6 h-6 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 19">
                        <path d="M14.5 0A3.987 3.987 0 0 0 11 2.1a4.977 4.977 0 0 1 3.9 5.858A3.989 3.989 0 0 0 14.5 0ZM9 13h2a4 4 0 0 1 4 4v2H5v-2a4 4 0 0 1 4-4Z"/>
                        <path d="M5 19h10v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2ZM5 7a5.008 5.008 0 0 1 4-4.9 3.988 3.988 0 1 0-3.9 5.859A4.974 4.974 0 0 1 5 7Zm5 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm5-1h-.424a5.016 5.016 0 0 1-1.942 2.232A6.007 6.007 0 0 1 17 17h2a1 1 0 0 0 1-1v-2a5.006 5.006 0 0 0-5-5ZM5.424 9H5a5.006 5.006 0 0 0-5 5v2a1 1 0 0 0 1 1h2a6.007 6.007 0 0 1 4.366-5.768A5.016 5.016 0 0 1 5.424 9Z"/>
                        </svg>
                     </div>
                     <div>
                        <h5 class="leading-none text-2xl font-bold text-gray-900 dark:text-white pb-1">Orders per Day</h5>
                        <p class="text-sm font-normal text-gray-500 dark:text-gray-400">Number of orders received each day</p>
                     </div>
                  </div>
                  </div>
               
                  <div class="grid grid-cols-2">
                  <dl class="flex items-center">
                        <dt class="text-gray-500 dark:text-gray-400 text-sm font-normal me-1">Total Orders (This Week):</dt>
                        <dd class="text-gray-900 text-sm dark:text-white font-semibold">{{ orders_this_week }}</dd>
                  </dl>
                  </div>
               
                  <div id="column-chart"></div>
                  <div class="grid grid-cols-1 items-center border-gray-200 border-t dark:border-gray-700 justify-between">
                     <div class="flex justify-between items-center pt-5">
                        <!-- Button -->
                        <button
                        id="dropdownDefaultButton-1"
                        data-dropdown-toggle="lastDaysdropdown-1"
                        data-dropdown-placement="bottom"
                        class="text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 text-center inline-flex items-center dark:hover:text-white"
                        type="button">
                        Last 7 days
                        <svg class="w-2.5 m-2.5 ms-1.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                           <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                        </svg>
                        </button>
                        <!-- Dropdown menu -->
                        <div id="lastDaysdropdown-1" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                           <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownDefaultButton-1">
                              <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Yesterday</a>
                              </li>
                              <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Today</a>
                              </li>
                              <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 7 days</a>
                              </li>
                              <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 30 days</a>
                              </li>
                              <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 90 days</a>
                              </li>
                           </ul>
                        </div>
                        <a
                        href="#"
                        class="uppercase text-sm font-semibold inline-flex items-center rounded-lg text-blue-600 hover:text-blue-700 dark:hover:text-blue-500  hover:bg-gray-100 dark:hover:bg-gray-700 dark:focus:ring-gray-700 dark:border-gray-700 px-3 py-2">
                        Orders Report
                        <svg class="w-2.5 h-2.5 ms-1.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                           <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                        </a>
                     </div>
                  </div>
               </div>
            {% comment %}  {% endcomment %}
             
           </div>
           <div class="col-span-1">
            {% comment %}  {% endcomment %}
               <div class=" w-full h-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">

                  <div class="flex justify-between items-start w-full">
                     <div class="flex-col items-center">
                        <div class="flex items-center mb-1">
                           <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white me-1">Order Status Distribution</h5>
                           <svg data-popover-target="chart-info" data-popover-placement="bottom" class="w-3.5 h-3.5 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white cursor-pointer ms-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                              <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm0 16a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm1-5.034V12a1 1 0 0 1-2 0v-1.418a1 1 0 0 1 1.038-.999 1.436 1.436 0 0 0 1.488-1.441 1.501 1.501 0 1 0-3-.116.986.986 0 0 1-1.037.961 1 1 0 0 1-.96-1.037A3.5 3.5 0 1 1 11 11.466Z"/>
                           </svg>
                           <div data-popover id="chart-info" role="tooltip" class="absolute z-10 invisible inline-block text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400">
                              <div class="p-3 space-y-2">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Order Status Distribution</h3>
                                    <p>This chart helps visualize the proportion of orders in different stages (e.g., pending, approved, delivered). It provides a quick overview of the order processing status.</p>
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Calculation</h3>
                                    <p>For each status, the percentage of total orders is calculated. This means that each slice of the pie chart represents the proportion of orders in that particular status.</p>
                                    <a href="#" class="flex items-center font-medium text-blue-600 dark:text-blue-500 dark:hover:text-blue-600 hover:text-blue-700 hover:underline">Read more <svg class="w-2 h-2 ms-1.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                              </svg></a>
                           </div>
                           <div data-popper-arrow></div>
                        </div>
                     </div>
                     </div>
                  </div>

                  <div class="flex justify-between pb-4 mb-4 border-b border-gray-200 dark:border-gray-700">
                     <!-- This div adds the border line after the pie chart -->
                 </div>
               
                  <!-- Line Chart -->
                  <div class="py-6" id="pie-chart"></div>
               
                  <div class="grid grid-cols-1 items-center border-gray-200 border-t dark:border-gray-700 justify-between">
                  <div class="flex justify-between items-center pt-5">
                     <!-- Button -->
                     <button
                        id="dropdownDefaultButton-2"
                        data-dropdown-toggle="lastDaysdropdown-2"
                        data-dropdown-placement="bottom"
                        class="text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 text-center inline-flex items-center dark:hover:text-white"
                        type="button">
                        Last 7 days
                        <svg class="w-2.5 m-2.5 ms-1.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                        </svg>
                     </button>
                     <div id="lastDaysdropdown-2" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                        <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownDefaultButton-2">
                           <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Yesterday</a>
                           </li>
                           <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Today</a>
                           </li>
                           <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 7 days</a>
                           </li>
                           <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 30 days</a>
                           </li>
                           <li>
                              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Last 90 days</a>
                           </li>
                        </ul>
                     </div>
                     <a
                        href="#"
                        class="uppercase text-sm font-semibold inline-flex items-center rounded-lg text-blue-600 hover:text-blue-700 dark:hover:text-blue-500  hover:bg-gray-100 dark:hover:bg-gray-700 dark:focus:ring-gray-700 dark:border-gray-700 px-3 py-2">
                        Order Status Report
                        <svg class="w-2.5 h-2.5 ms-1.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                     </a>
                  </div>
                  </div>
               </div>
            {% comment %}  {% endcomment %}
           </div>
         </div>
        
        <div class="flex items-center justify-center rounded bg-gray-50 dark:bg-gray-800 mt-5" style="max-height: 400px; overflow-y: auto;">
               <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                  <caption class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
                     Recent Transactions
                     <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">
                        Below is a list of the most recent transactions. This includes all completed payments, refunds, and adjustments. Use this list to monitor your business's cash flow and transaction trends.
                    </p>
                  </caption>
                  <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                     <tr>
                           <th scope="col" class="px-6 py-3">
                              Order Number
                           </th>
                           <th scope="col" class="px-6 py-3">
                              Order Date
                           </th>
                           <th scope="col" class="px-6 py-3">
                              Retailer
                           </th>
                           <th scope="col" class="px-6 py-3">
                              Order ID
                           </th>
                           <th scope="col" class="px-6 py-3">
                              Payment ID
                           </th>
                           <th scope="col" class="px-6 py-3">
                              Amount
                           </th>
                     </tr>
                  </thead>
                  <tbody>
                     {% for payment in payments %}
                     <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            {{ payment.order.order_number }}
                        </th>
                        <td class="px-6 py-4">
                            {{ payment.order.order_date }}
                        </td>
                        <td class="px-6 py-4">
                            {{ payment.order.retailer.first_name }} {{ payment.order.retailer.last_name }}
                        </td>
                        <td class="px-6 py-4">
                            {{ payment.razorpay_order_id }}
                        </td>
                        <td class="px-6 py-4">
                            {{ payment.payment_id }}
                        </td>
                        <td class="px-6 py-4">
                           ₹{{ payment.amount }}
                        </td>
                    </tr>
                    {% endfor %}
                  </tbody>
               </table>
        </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
   const getChartOptions = () => {
      return {
      series: [{{ pending_percentage }}, {{ approved_percentage }}, {{ delivered_percentage }}],
      colors: ["#1C64F2", "#16BDCA", "#9061F9"],
      chart: {
         height: 420,
         width: "100%",
         type: "pie",
      },
      stroke: {
         colors: ["white"],
         lineCap: "",
      },
      plotOptions: {
         pie: {
            labels: {
            show: true,
            },
            size: "100%",
            dataLabels: {
            offset: -25
            }
         },
      },
      labels: ["Pending", "Approved", "Delivered"],
      dataLabels: {
         enabled: true,
         style: {
            fontFamily: "Inter, sans-serif",
         },
      },
      legend: {
         position: "bottom",
         fontFamily: "Inter, sans-serif",
      },
      yaxis: {
         labels: {
            formatter: function (value) {
            return value + "%"
            },
         },
      },
      xaxis: {
         labels: {
            formatter: function (value) {
            return value  + "%"
            },
         },
         axisTicks: {
            show: false,
         },
         axisBorder: {
            show: false,
         },
      },
      }
   }
   
   if (document.getElementById("pie-chart") && typeof ApexCharts !== 'undefined') {
      const chart = new ApexCharts(document.getElementById("pie-chart"), getChartOptions());
      chart.render();
   }
</script>
<script>
   // Get the data from the Django context
   let ordersData = {{ orders_data|safe }};
   let amountData = {{ amount_data|safe }};
   
   // Convert the data to the format expected by ApexCharts
   let chartData = ordersData.map((count, i) => ({
     x: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'][i],
     y: count,
   }));
   
   const options = {
     colors: ["#1A56DB"],
     series: [
       {
         name: "Orders",
         color: "#1A56DB",
         data: chartData,
       },
     ],
     chart: {
       type: "bar",
       height: "345px",
       fontFamily: "Inter, sans-serif",
       toolbar: {
         show: false,
       },
     },
     plotOptions: {
       bar: {
         horizontal: false,
         columnWidth: "70%",
         borderRadiusApplication: "end",
         borderRadius: 8,
       },
     },
     tooltip: {
       shared: true,
       intersect: false,
       style: {
         fontFamily: "Inter, sans-serif",
       },
     },
     states: {
       hover: {
         filter: {
           type: "darken",
           value: 1,
         },
       },
     },
     stroke: {
       show: true,
       width: 0,
       colors: ["transparent"],
     },
     grid: {
       show: false,
       strokeDashArray: 4,
       padding: {
         left: 2,
         right: 2,
         top: -14,
       },
     },
     dataLabels: {
       enabled: false,
     },
     legend: {
       show: false,
     },
     xaxis: {
       floating: false,
       labels: {
         show: true,
         style: {
           fontFamily: "Inter, sans-serif",
           cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400',
         },
       },
       axisBorder: {
         show: false,
       },
       axisTicks: {
         show: false,
       },
     },
     yaxis: {
       show: false,
     },
     fill: {
       opacity: 1,
     },
   };
   
   if (document.getElementById("column-chart") && typeof ApexCharts !== 'undefined') {
     const chart = new ApexCharts(document.getElementById("column-chart"), options);
     chart.render();
   }
   </script>
{% endblock %}